<!DOCTYPE html>
<html>
  <head>
    <script src="stomp.js"></script>
    <title>Covid reactions on Twitter</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <meta charset="UTF-8" />
    <script
      type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbRYTq0Tci_CwdjsRZxU9k8lGghiJViPE&libraries=visualization"
    ></script>
    <script type="text/javascript">
      var map, heatmap, data;
      var nextStore = 0;
      var year = 1962;
      var month = 1;
      var running = false;
      var unlock = false;

      function initialize() {
        data = new google.maps.MVCArray();

        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 4.8,
          center: new google.maps.LatLng(-15.41, -50.42),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          styles: [
            {
              stylers: [{ saturation: -10 }],
            },
            {
              featureType: "poi.park",
              stylers: [{ visibility: "off" }],
            },
          ],
          disableDefaultUI: true,
        });

        heatmap = new google.maps.visualization.HeatmapLayer({
          map: map,
          data: data,
          radius: 16,
          dissipate: false,
          maxIntensity: 8,
          gradient: [
            "rgba(0, 0, 0, 0)",
            "rgba(255, 255, 0, 0.50)",
            "rgba(0, 0, 255, 1.0)",
          ],
        });

        google.maps.event.addListener(map, "mouseout", stop);
        google.maps.event.addListener(map, "tilesloaded", function () {
          unlock = true;
        });
      }

      function start() {
        if (unlock && !running) {
          document.getElementById("lightbox").style.display = "none";
          document.getElementById("msg").style.display = "none";
          running = true;
          nextMonth();
        }
      }

      function stop() {
        document.getElementById("lightbox").style.display = "block";
        document.getElementById("msg").style.display = "block";
        running = false;
      }

      function nextMonth() {
        if (!running) {
          return;
        }
        while (
          stores[nextStore].date[0] <= year &&
          stores[nextStore].date[1] <= month
        ) {
          data.push(
            new google.maps.LatLng(
              stores[nextStore].coords[0],
              stores[nextStore].coords[1]
            )
          );
          nextStore++;
        }
        if (nextStore < stores.length) {
          if (month == 12) {
            month = 1;
            year++;
            document.getElementById("year").innerHTML = year;
          } else {
            month++;
          }
          setTimeout(nextMonth, 30);
        }
      }
    </script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        width: 1200px;
        height: 800px;
        position: absolute;
        border: 1px solid black;
      }
      #legenda {
        position: absolute;
        top: 750px;
        left: 960px;
        font-size: 30px;
        font-family: sans-serif;
        font-weight: bold;
        text-shadow: 0.1em 0.1em 0.2em rgb(255, 255, 255);
        color: rgb(53, 106, 223);
      }
    </style>
  </head>
  <body onload="initialize()">
    <div id="map"></div>
    <div id="legenda">Covid reactions</div>
  </body>


  <script>
      //-----------------------------------------------------------------------------
      //Script para conex√£o e assinatura da fila de dados
      //-----------------------------------------------------------------------------

      //tweets
      var client_tweet = Stomp.client('ws://localhost:15674/ws');

      var on_connect_tweet = function(x) {
          id = client_tweet.subscribe("/exchange/TWEETS", function(d) {
              data = JSON.parse(d.body);
              console.log("data");
              console.log(data);
              //console.log(data[0]["sum(pontos)"]);

              //textViewPlacarHome.textContent = data[0]["sum(pontos)"]; 
          });
      };
      var on_error_tweet =  function() {
      console.log('error');
      };
      client_tweet.connect('guest', 'guest', on_connect_tweet, on_error_tweet, '/');



  </script>

</html>